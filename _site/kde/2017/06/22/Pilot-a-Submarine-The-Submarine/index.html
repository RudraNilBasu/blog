<!DOCTYPE html>
<html>

    <head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pilot a Submarine- The Submarine</title>
<meta name="description" content="Random stuff.">

<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<link rel="stylesheet" type="text/css" media="all" href="/css/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/jquery.mmenu.all.css" />
<link rel="stylesheet" href="/css/highlightjs.piperita.css">

<!-- Favicons generated at http://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/favicons/manifest.json">
<link rel="shortcut icon" href="/favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-TileImage" content="/favicons/mstile-144x144.png">
<meta name="msapplication-config" content="/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">





</head>


    <body>

    <nav id="my-menu">
  <div>
    <p>Rudra's Yard</p>

    <ul class="pages">
      <li><a href="/"><i class="fa fa-home"></i> Home</a></li>
      <li><a href="/posts/"><i class="fa fa-archive"></i> All Posts</a></li>
      <li><a href="/search/"><i class="fa fa-search"></i> Search</a></li>
    </ul>

    <p class="links">
  <a href="https://www.twitter.com/RudraNilBasu" target="_new"><i class="fa fa-twitter"></i></a>
  <a href="https://in.linkedin.com/in/rudra-nil-basu-7a1679a4" target="_new"><i class="fa fa-linkedin"></i></a>
  
  
  <a href="facebook.com/rudra.n.basu" target="_new"><i class="fa fa-facebook"></i></a>
  <a href="https://github.com/RudraNilBasu" target="_new"><i class="fa fa-github-alt"></i></a>
  
  <a href="https://www.instagram.com/RudraNilBasu" target="_new"><i class="fa fa-instagram"></i></a>
  <a href="/feed.xml" target="_new"><i class="fa fa-rss"></i></a>
</p>

  </div>
</nav>
<div class="menu-button" href="#menu"><i class="fa fa-bars"></i></div>


    <div class="page-content">
      <div class="wrap">
      

<div class="container-fluid single">
  <div class="row">

    <div itemscope itemtype="http://schema.org/Article" class="col-md-12 article">
      
      <div class="thumb">
        <img itemprop="image" src="https://www.kde.org/stuff/clipart/klogo-official-lineart_detailed-3000x3000.png" alt="Thumbnail: kde" />
      </div>
      

      <h1 class="header" itemprop="name">Pilot a Submarine- The Submarine</h1>

      <div class="author">
        <small><i>
          
          on <span itemprop="datePublished" content="2014-08-28">June 22, 2017</span>
           under kde
        </i></small>
      </div>

      <div class="read-time">
        <small>
          16 minute read
        </small>
      </div>

      <div class="content-panel content">

        

        <span itemprop="articleBody"><p>In this post, I am going to discuss about the working of a submarine and my thought process on implementing the three basic features of a submarine in the <em>“Pilot a Submarine”</em> activity for the Qt version of GCompris, which are:</p>

<ul>
  <li>The Engine</li>
  <li>The Ballast tanks and</li>
  <li>The Diving Planes</li>
</ul>

<hr />

<h3 id="the-engine">The Engine</h3>

<p>The engine of most submarines are either nuclear powered or diesel-electric engines, which are used to drive an electric motor which in turn, powers the submarine propellers. In this implementation, we will have two buttons one for increasing and another for decreasing the power generated by the submarine.</p>

<h3 id="ballast-tanks">Ballast Tanks</h3>

<p>The Ballast Tanks are the spaces in the submarine that can either be filled with water or air. It helps the submarine to dive and resurface on the water, using the concept of buouyancy. If the tanks are filled with water, the submarine dives underwater and if they are filled with air, it resurfaces on the surface of the water</p>

<h3 id="diving-planes">Diving Planes</h3>

<p>Once underwater, the diving planes of a submarine helps to accurately control the depth of the submarine. These are very similar to the fins present in the bodies of sharks, which helps them to swim and dive. When the planes are pointed downwards, the water flowing above the planes generate more pressure on the top surface than that on the bottom surface, forcing the submarine to dive deeper. This allows the driver to control the depth and the angle of the submarine.</p>

<h3 id="implementation">Implementation</h3>

<p>In this section I will be going through how I implemented the submarine using QML. For handling physics, I used <a href="http://box2d.org/">Box2D</a>.</p>

<h4 id="the-submarine">The Submarine</h4>

<p>The submarine is an QML <code class="highlighter-rouge">Item</code> element, designed as follows:</p>

<div class="language-qml highlighter-rouge"><pre class="highlight"><code><span class="kt">Item</span> <span class="p">{</span>
    <span class="nl">id</span><span class="p">:</span> <span class="nx">submarine</span>

    <span class="nl">z</span><span class="p">:</span> <span class="mi">1</span>

    <span class="kd">property</span> <span class="kt">point</span> <span class="nl">initialPosition</span><span class="p">:</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="kd">property</span> <span class="kt">bool</span> <span class="nl">isHit</span><span class="p">:</span> <span class="kc">false</span>
    <span class="kd">property</span> <span class="kt">int</span> <span class="nl">terminalVelocityIndex</span><span class="p">:</span> <span class="mi">100</span>
    <span class="kd">property</span> <span class="kt">int</span> <span class="nl">resetVerticalSpeed</span><span class="p">:</span> <span class="mi">500</span>

    <span class="cm">/* Maximum depth the submarine can dive when ballast tank is full */</span>
    <span class="kd">property</span> <span class="kt">real</span> <span class="nl">maximumDepthOnFullTanks</span><span class="p">:</span> <span class="p">(</span><span class="nx">background</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="cm">/* Engine properties */</span>
    <span class="kd">property</span> <span class="kt">point</span> <span class="nl">velocity</span>
    <span class="kd">property</span> <span class="kt">int</span> <span class="nl">maximumXVelocity</span><span class="p">:</span> <span class="mi">5</span>

    <span class="cm">/* Wings property */</span>
    <span class="kd">property</span> <span class="kt">int</span> <span class="nl">wingsAngle</span>
    <span class="kd">property</span> <span class="kt">int</span> <span class="nl">initialWingsAngle</span><span class="p">:</span> <span class="mi">0</span>
    <span class="kd">property</span> <span class="kt">int</span> <span class="nl">maxWingsAngle</span><span class="p">:</span> <span class="mi">2</span>
    <span class="kd">property</span> <span class="kt">int</span> <span class="nl">minWingsAngle</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span>

    <span class="kd">function</span> <span class="nx">destroySubmarine</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">isHit</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="nx">submarineImage</span><span class="p">.</span><span class="nx">broken</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">resetSubmarine</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">isHit</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="nx">submarineImage</span><span class="p">.</span><span class="nx">reset</span><span class="p">()</span>

        <span class="nx">leftBallastTank</span><span class="p">.</span><span class="nx">resetBallastTanks</span><span class="p">()</span>
        <span class="nx">rightBallastTank</span><span class="p">.</span><span class="nx">resetBallastTanks</span><span class="p">()</span>
        <span class="nx">centralBallastTank</span><span class="p">.</span><span class="nx">resetBallastTanks</span><span class="p">()</span>

        <span class="nx">x</span> <span class="o">=</span> <span class="nx">initialPosition</span><span class="p">.</span><span class="nx">x</span>
        <span class="nx">y</span> <span class="o">=</span> <span class="nx">initialPosition</span><span class="p">.</span><span class="nx">y</span>

        <span class="nx">velocity</span> <span class="o">=</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="nx">wingsAngle</span> <span class="o">=</span> <span class="nx">initialWingsAngle</span>
    <span class="p">}</span>

	<span class="kd">function</span> <span class="nx">increaseHorizontalVelocity</span><span class="p">(</span><span class="nx">amt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">amt</span> <span class="o">&lt;=</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">maximumXVelocity</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">amt</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">decreaseHorizontalVelocity</span><span class="p">(</span><span class="nx">amt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">amt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="nx">amt</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">increaseWingsAngle</span><span class="p">(</span><span class="nx">amt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">wingsAngle</span> <span class="o">+</span> <span class="nx">amt</span> <span class="o">&lt;=</span> <span class="nx">maxWingsAngle</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">wingsAngle</span> <span class="o">+=</span> <span class="nx">amt</span>
        <span class="p">}</span> <span class="kt">else</span> <span class="p">{</span>
            <span class="nx">wingsAngle</span> <span class="o">=</span> <span class="nx">maxWingsAngle</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">decreaseWingsAngle</span><span class="p">(</span><span class="nx">amt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">wingsAngle</span> <span class="o">-</span> <span class="nx">amt</span> <span class="o">&gt;=</span> <span class="nx">minWingsAngle</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">wingsAngle</span> <span class="o">-=</span> <span class="nx">amt</span>
        <span class="p">}</span> <span class="kt">else</span> <span class="p">{</span>
            <span class="nx">wingsAngle</span> <span class="o">=</span> <span class="nx">minWingsAngle</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">changeVerticalVelocity</span><span class="p">()</span> <span class="p">{</span>
        <span class="cm">/*
         * Movement due to planes
         * Movement is affected only when the submarine is moving forward
         * When the submarine is on the surface, the planes cannot be used
         */</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">submarineImage</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">wingsAngle</span> <span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span> <span class="kt">else</span> <span class="p">{</span>
            <span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="p">}</span>
        <span class="cm">/* Movement due to Ballast tanks */</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">wingsAngle</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">yPosition</span> <span class="o">=</span> <span class="nx">submarineImage</span><span class="p">.</span><span class="nx">currentWaterLevel</span> <span class="o">/</span> <span class="nx">submarineImage</span><span class="p">.</span><span class="nx">totalWaterLevel</span> <span class="o">*</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">maximumDepthOnFullTanks</span>

            <span class="nx">speed</span><span class="p">.</span><span class="nx">duration</span> <span class="o">=</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">terminalVelocityIndex</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">submarineImage</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">yPosition</span><span class="p">)</span> <span class="c1">// terminal velocity</span>
            <span class="nx">submarineImage</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">yPosition</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">BallastTank</span> <span class="p">{</span>
        <span class="nl">id</span><span class="p">:</span> <span class="nx">leftBallastTank</span>

        <span class="nl">initialWaterLevel</span><span class="p">:</span> <span class="mi">0</span>
        <span class="nl">maxWaterLevel</span><span class="p">:</span> <span class="mi">500</span>
    <span class="p">}</span>

    <span class="kt">BallastTank</span> <span class="p">{</span>
        <span class="nl">id</span><span class="p">:</span> <span class="nx">rightBallastTank</span>

        <span class="nl">initialWaterLevel</span><span class="p">:</span> <span class="mi">0</span>
        <span class="nl">maxWaterLevel</span><span class="p">:</span> <span class="mi">500</span>
    <span class="p">}</span>

    <span class="kt">BallastTank</span> <span class="p">{</span>
        <span class="nl">id</span><span class="p">:</span> <span class="nx">centralBallastTank</span>

        <span class="nl">initialWaterLevel</span><span class="p">:</span> <span class="mi">0</span>
        <span class="nl">maxWaterLevel</span><span class="p">:</span> <span class="mi">500</span>
    <span class="p">}</span>

    <span class="kt">Image</span> <span class="p">{</span>
        <span class="nl">id</span><span class="p">:</span> <span class="nx">submarineImage</span>
        <span class="nl">source</span><span class="p">:</span> <span class="nx">url</span> <span class="o">+</span> <span class="s2">"submarine.png"</span>

        <span class="kd">property</span> <span class="kt">int</span> <span class="nl">currentWaterLevel</span><span class="p">:</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">level</span> <span class="o">&lt;</span> <span class="mi">7</span> <span class="p">?</span> <span class="nx">centralBallastTank</span><span class="p">.</span><span class="nx">waterLevel</span> <span class="p">:</span> <span class="nx">leftBallastTank</span><span class="p">.</span><span class="nx">waterLevel</span> <span class="o">+</span> <span class="nx">centralBallastTank</span><span class="p">.</span><span class="nx">waterLevel</span> <span class="o">+</span> <span class="nx">rightBallastTank</span><span class="p">.</span><span class="nx">waterLevel</span>
        <span class="kd">property</span> <span class="kt">int</span> <span class="nl">totalWaterLevel</span><span class="p">:</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">level</span> <span class="o">&lt;</span> <span class="mi">7</span> <span class="p">?</span> <span class="nx">centralBallastTank</span><span class="p">.</span><span class="nx">maxWaterLevel</span> <span class="p">:</span> <span class="nx">leftBallastTank</span><span class="p">.</span><span class="nx">maxWaterLevel</span> <span class="o">+</span> <span class="nx">centralBallastTank</span><span class="p">.</span><span class="nx">maxWaterLevel</span> <span class="o">+</span> <span class="nx">rightBallastTank</span><span class="p">.</span><span class="nx">maxWaterLevel</span>

        <span class="nl">width</span><span class="p">:</span> <span class="nx">background</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">9</span>
        <span class="nl">height</span><span class="p">:</span> <span class="nx">background</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">9</span>

        <span class="kd">function</span> <span class="nx">broken</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">source</span> <span class="o">=</span> <span class="nx">url</span> <span class="o">+</span> <span class="s2">"submarine-broken.png"</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">reset</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">source</span> <span class="o">=</span> <span class="nx">url</span> <span class="o">+</span> <span class="s2">"submarine.png"</span>
            <span class="nx">speed</span><span class="p">.</span><span class="nx">duration</span> <span class="o">=</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">resetVerticalSpeed</span>
            <span class="nx">x</span> <span class="o">=</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">initialPosition</span><span class="p">.</span><span class="nx">x</span>
            <span class="nx">y</span> <span class="o">=</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">initialPosition</span><span class="p">.</span><span class="nx">y</span>
        <span class="p">}</span>

        <span class="kt">Behavior</span> <span class="k">on</span> <span class="nl">y</span> <span class="p">{</span>
            <span class="kt">NumberAnimation</span> <span class="p">{</span>
                <span class="nl">id</span><span class="p">:</span> <span class="nx">speed</span>
                <span class="nl">duration</span><span class="p">:</span> <span class="mi">500</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nl">onXChanged</span><span class="p">:</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">submarineImage</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;=</span> <span class="nx">background</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Activity</span><span class="p">.</span><span class="nx">finishLevel</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">Body</span> <span class="p">{</span>
        <span class="nl">id</span><span class="p">:</span> <span class="nx">submarineBody</span>
        <span class="nl">target</span><span class="p">:</span> <span class="nx">submarineImage</span>
        <span class="nl">bodyType</span><span class="p">:</span> <span class="nx">Body</span><span class="p">.</span><span class="nx">Dynamic</span>
        <span class="nl">fixedRotation</span><span class="p">:</span> <span class="kc">true</span>
        <span class="nl">linearDamping</span><span class="p">:</span> <span class="mi">0</span>
        <span class="nl">linearVelocity</span><span class="p">:</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">isHit</span> <span class="p">?</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span>

        <span class="nl">fixtures</span><span class="p">:</span> <span class="kt">Box</span> <span class="p">{</span>
            <span class="nl">id</span><span class="p">:</span> <span class="nx">submarineFixer</span>
            <span class="nl">width</span><span class="p">:</span> <span class="nx">submarineImage</span><span class="p">.</span><span class="nx">width</span>
            <span class="nl">height</span><span class="p">:</span> <span class="nx">submarineImage</span><span class="p">.</span><span class="nx">height</span>
            <span class="nl">categories</span><span class="p">:</span> <span class="nx">items</span><span class="p">.</span><span class="nx">submarineCategory</span>
            <span class="nl">collidesWith</span><span class="p">:</span> <span class="nx">Fixture</span><span class="p">.</span><span class="nx">All</span>
            <span class="nl">density</span><span class="p">:</span> <span class="mi">1</span>
            <span class="nl">friction</span><span class="p">:</span> <span class="mi">0</span>
            <span class="nl">restitution</span><span class="p">:</span> <span class="mi">0</span>
            <span class="nl">onBeginContact</span><span class="p">:</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">collidedObject</span> <span class="o">=</span> <span class="nx">other</span><span class="p">.</span><span class="nx">getBody</span><span class="p">().</span><span class="nx">target</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">collidedObject</span> <span class="o">==</span> <span class="nx">whale</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">whale</span><span class="p">.</span><span class="nx">hit</span><span class="p">()</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">collidedObject</span> <span class="o">==</span> <span class="nx">crown</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">crown</span><span class="p">.</span><span class="nx">captureCrown</span><span class="p">()</span>
                <span class="p">}</span> <span class="kt">else</span> <span class="p">{</span>
                    <span class="nx">Activity</span><span class="p">.</span><span class="nx">finishLevel</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">Timer</span> <span class="p">{</span>
        <span class="nl">id</span><span class="p">:</span> <span class="nx">updateVerticalVelocity</span>
        <span class="nl">interval</span><span class="p">:</span> <span class="mi">50</span>
        <span class="nl">running</span><span class="p">:</span> <span class="kc">true</span>
        <span class="nl">repeat</span><span class="p">:</span> <span class="kc">true</span>

        <span class="nl">onTriggered</span><span class="p">:</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">changeVerticalVelocity</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">Item</code> is a parent object to hold all the different components of the submarine (the <code class="highlighter-rouge">Image</code> <code class="highlighter-rouge">BallastTank</code> and the Box2D component). It also contains the functions and the variables that are global to the submarine.</p>

<h4 id="the-engine-1">The Engine</h4>

<p>The engine is a very straightforward implementation via the <code class="highlighter-rouge">linearVelocity</code> component of the Box2D element. We have two variables global to the submarine for handling the engine component, defined as follows:</p>

<div class="language-qml highlighter-rouge"><pre class="highlight"><code><span class="nx">property</span> <span class="nx">point</span> <span class="nx">velocity</span>
<span class="nx">property</span> <span class="kr">int</span> <span class="nx">maximumXVelocity</span><span class="err">:</span> <span class="mi">5</span>
</code></pre>
</div>

<p>which are pretty much self-explanatory, the <code class="highlighter-rouge">velocity</code> holds the current velocity of the submarine, both horizontal and vertical and the <code class="highlighter-rouge">maximumXVelocity</code> holds the maximum horizontal speed the submarine can achieve.</p>

<p>For increasing or decreasing the velocity of the submarine, we have two functions global to the <code class="highlighter-rouge">submarine</code>, as follows:</p>

<div class="language-qml highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">increaseHorizontalVelocity</span><span class="p">(</span><span class="nx">amt</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">amt</span> <span class="o">&lt;=</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">maximumXVelocity</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">amt</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">decreaseHorizontalVelocity</span><span class="p">(</span><span class="nx">amt</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">amt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="nx">amt</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>which essentially gets the amount by which the <code class="highlighter-rouge">velocity.x</code> component needs to be increased or decreased, checks whether it crosses the range or not, and makes the necessary changes likewise.</p>

<p>The actual applying of the velocity is very straightforward, which takes place in the <code class="highlighter-rouge">Body</code> component of the submarine as follows:</p>

<div class="language-qml highlighter-rouge"><pre class="highlight"><code><span class="kt">Body</span> <span class="p">{</span>
	<span class="p">...</span>
	<span class="nl">linearVelocity</span><span class="p">:</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">isHit</span> <span class="p">?</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span>
	<span class="p">...</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">submarine.isHit</code> component, as the name suggests holds whether the submarine is hit by any object or not (except the pickups). If so, the velocity is reset to (0,0)</p>

<p>Thus, for increasing or decreasing the engine power, we just have to call one of the two functions anywhere from the code:</p>

<div class="language-qml highlighter-rouge"><pre class="highlight"><code><span class="nx">submarine</span><span class="p">.</span><span class="nx">increaseHorizontalVelocity</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="cm">/* For increasing H velocity */</span>
<span class="nx">submarine</span><span class="p">.</span><span class="nx">decreaseHorizontalVelocity</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="cm">/* For decreasing H velocity */</span>
</code></pre>
</div>

<h4 id="the-ballast-tanks">The Ballast Tanks</h4>

<p>The Ballast Tanks are implemented separately in <code class="highlighter-rouge">BallastTank.qml</code>, since it will be implemented more that once. It looks like the following:</p>

<div class="language-qml highlighter-rouge"><pre class="highlight"><code><span class="kt">Item</span> <span class="p">{</span>
    <span class="kd">property</span> <span class="kt">int</span> <span class="nl">initialWaterLevel</span>
    <span class="kd">property</span> <span class="kt">int</span> <span class="nl">waterLevel</span><span class="p">:</span> <span class="mi">0</span>
    <span class="kd">property</span> <span class="kt">int</span> <span class="nl">maxWaterLevel</span>
    <span class="kd">property</span> <span class="kt">int</span> <span class="nl">waterRate</span><span class="p">:</span> <span class="mi">10</span>
    <span class="kd">property</span> <span class="kt">bool</span> <span class="nl">waterFilling</span><span class="p">:</span> <span class="kc">false</span>
    <span class="kd">property</span> <span class="kt">bool</span> <span class="nl">waterFlushing</span><span class="p">:</span> <span class="kc">false</span>

    <span class="kd">function</span> <span class="nx">fillBallastTanks</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">waterFilling</span> <span class="o">=</span> <span class="o">!</span><span class="nx">waterFilling</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">waterFilling</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fillBallastTanks</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>
        <span class="p">}</span> <span class="kt">else</span> <span class="p">{</span>
            <span class="nx">fillBallastTanks</span><span class="p">.</span><span class="nx">stop</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">flushBallastTanks</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">waterFlushing</span> <span class="o">=</span> <span class="o">!</span><span class="nx">waterFlushing</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">waterFlushing</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">flushBallastTanks</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>
        <span class="p">}</span> <span class="kt">else</span> <span class="p">{</span>
            <span class="nx">flushBallastTanks</span><span class="p">.</span><span class="nx">stop</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">updateWaterLevel</span><span class="p">(</span><span class="nx">isInflow</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">isInflow</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">waterLevel</span> <span class="o">&lt;</span> <span class="nx">maxWaterLevel</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">waterLevel</span> <span class="o">+=</span> <span class="nx">waterRate</span>

            <span class="p">}</span>
        <span class="p">}</span> <span class="kt">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">waterLevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">waterLevel</span> <span class="o">-=</span> <span class="nx">waterRate</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">waterLevel</span> <span class="o">&gt;</span> <span class="nx">maxWaterLevel</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">waterLevel</span> <span class="o">=</span> <span class="nx">maxWaterLevel</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">waterLevel</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">waterLevel</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">resetBallastTanks</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">waterFilling</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="nx">waterFlushing</span> <span class="o">=</span> <span class="kc">false</span>

        <span class="nx">waterLevel</span> <span class="o">=</span> <span class="nx">initialWaterLevel</span>

        <span class="nx">fillBallastTanks</span><span class="p">.</span><span class="nx">stop</span><span class="p">()</span>
        <span class="nx">flushBallastTanks</span><span class="p">.</span><span class="nx">stop</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kt">Timer</span> <span class="p">{</span>
        <span class="nl">id</span><span class="p">:</span> <span class="nx">fillBallastTanks</span>
        <span class="nl">interval</span><span class="p">:</span> <span class="mi">500</span>
        <span class="nl">running</span><span class="p">:</span> <span class="kc">false</span>
        <span class="nl">repeat</span><span class="p">:</span> <span class="kc">true</span>

        <span class="nl">onTriggered</span><span class="p">:</span> <span class="nx">updateWaterLevel</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kt">Timer</span> <span class="p">{</span>
        <span class="nl">id</span><span class="p">:</span> <span class="nx">flushBallastTanks</span>
        <span class="nl">interval</span><span class="p">:</span> <span class="mi">500</span>
        <span class="nl">running</span><span class="p">:</span> <span class="kc">false</span>
        <span class="nl">repeat</span><span class="p">:</span> <span class="kc">true</span>

        <span class="nl">onTriggered</span><span class="p">:</span> <span class="nx">updateWaterLevel</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>What they essentially does is:</p>
<ul>
  <li><code class="highlighter-rouge">fillBallastTanks</code>: Fills up the Ballast tanks upto <code class="highlighter-rouge">maxWaterLevel</code>. Sets the flag <code class="highlighter-rouge">waterFilling</code> to true if the Ballast is to be filled with water, and the timer <code class="highlighter-rouge">fillBallastTanks</code> is set to <code class="highlighter-rouge">start()</code>, which will increase the water level in the tank after every 500 millisecond.</li>
  <li><code class="highlighter-rouge">flushBallastTanks</code>: Flushes the Ballast tanks down to 0. Sets the flag <code class="highlighter-rouge">waterFlushing</code> to true if the Ballast is to be flushed out of water, and the timer <code class="highlighter-rouge">flushBallastTanks</code> is set to <code class="highlighter-rouge">start()</code>, which will decrease the water level in the tank after every 500 millisecond.</li>
  <li><code class="highlighter-rouge">resetBallastTanks</code>: Resets the water level in the ballast tanks to it’s initial values</li>
</ul>

<p>In the Submarine <code class="highlighter-rouge">Item</code>, we just use three instances of the <code class="highlighter-rouge">BallastTank</code> object, for left, right and central ballast tanks, setting up it’s initial and maximum water level.</p>

<div class="language-qml highlighter-rouge"><pre class="highlight"><code><span class="kt">BallastTank</span> <span class="p">{</span>
    <span class="nl">id</span><span class="p">:</span> <span class="nx">leftBallastTank</span>

    <span class="nl">initialWaterLevel</span><span class="p">:</span> <span class="mi">0</span>
    <span class="nl">maxWaterLevel</span><span class="p">:</span> <span class="mi">500</span>
<span class="p">}</span>

<span class="kt">BallastTank</span> <span class="p">{</span>
    <span class="nl">id</span><span class="p">:</span> <span class="nx">rightBallastTank</span>

    <span class="nl">initialWaterLevel</span><span class="p">:</span> <span class="mi">0</span>
    <span class="nl">maxWaterLevel</span><span class="p">:</span> <span class="mi">500</span>
<span class="p">}</span>

<span class="kt">BallastTank</span> <span class="p">{</span>
    <span class="nl">id</span><span class="p">:</span> <span class="nx">centralBallastTank</span>

    <span class="nl">initialWaterLevel</span><span class="p">:</span> <span class="mi">0</span>
    <span class="nl">maxWaterLevel</span><span class="p">:</span> <span class="mi">500</span>
<span class="p">}</span>
</code></pre>
</div>

<p>For filling up or flushing the ballast tanks (<code class="highlighter-rouge">centralBallastTank</code> in this case), we just have two call either of the following two functions:</p>

<div class="language-qml highlighter-rouge"><pre class="highlight"><code><span class="nx">centralBallastTank</span><span class="p">.</span><span class="nx">fillBallastTanks</span><span class="p">()</span> <span class="cm">/* For filling */</span>
<span class="nx">centralBallastTank</span><span class="p">.</span><span class="nx">flushBallastTanks</span><span class="p">()</span> <span class="cm">/* For flushing */</span>
</code></pre>
</div>

<p>I will be discussing about how the depth is maintained using the ballast tanks in the next section.</p>

<h4 id="the-diving-planes">The Diving Planes</h4>

<p>The diving planes will be used to control the depth of the submarine once it is <strong>moving underwater</strong>. Keeping that in mind, along with the fact that it needs to be effectively integrated with the ballast tanks. This is implemented in the <code class="highlighter-rouge">changeVerticalVelocity()</code> function, which is discussed as follows:</p>

<div class="language-qml highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
 * Movement due to planes
 * Movement is affected only when the submarine is moving forward
 * When the submarine is on the surface, the planes cannot be used
 */</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">submarineImage</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">wingsAngle</span> <span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span> <span class="kt">else</span> <span class="p">{</span>
    <span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">}</span>
</code></pre>
</div>

<p>However, under the following conditions:</p>
<ul>
  <li>the angle of the planes is reduced to 0</li>
  <li>the horizontal velocity of the submarine is 0,</li>
</ul>

<p>the ballast tanks will take over. Which is implemented as:</p>

<div class="language-qml highlighter-rouge"><pre class="highlight"><code><span class="cm">/* Movement due to Ballast tanks */</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">wingsAngle</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">yPosition</span> <span class="o">=</span> <span class="nx">submarineImage</span><span class="p">.</span><span class="nx">currentWaterLevel</span> <span class="o">/</span> <span class="nx">submarineImage</span><span class="p">.</span><span class="nx">totalWaterLevel</span> <span class="o">*</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">maximumDepthOnFullTanks</span>

    <span class="nx">speed</span><span class="p">.</span><span class="nx">duration</span> <span class="o">=</span> <span class="nx">submarine</span><span class="p">.</span><span class="nx">terminalVelocityIndex</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">submarineImage</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">yPosition</span><span class="p">)</span> <span class="c1">// terminal velocity</span>
    <span class="nx">submarineImage</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">yPosition</span>
<span class="p">}</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">yPosition</code> calculates how much percentage of the tank is filled with water, and likewise it determines the depth to which it will dive. The <code class="highlighter-rouge">speed.duration</code> is the duration of the transition animation, and the duration depends directly on how much the submarine will have to cover up along the Y axis, to avoid a steep rise or fall of the submarine.</p>

<p>For increasing or decreasing the angle of the diving planes, we just need to call either of the following two functions:</p>

<div class="language-qml highlighter-rouge"><pre class="highlight"><code><span class="nx">submarine</span><span class="p">.</span><span class="nx">increaseWinglsAngle</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="cm">/* For increasing */</span>
<span class="nx">submarine</span><span class="p">.</span><span class="nx">decreaseWingsAngle</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="cm">/* For decerasing */</span>
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/RudraNilBasu/blog/gh-pages/images/gsoc/gsoc_submarine_22_07.jpg" alt="img" /></p>

<hr />

<p>That’s it for now! The two major goals to be completed next are the rotation of the submarine (in case more than one tanks are used and they are unequally filled up) and the UI for controlling the submarine. Will provide an update on it once it is completed.</p>
</span>

        

        

        
        <div class="tags">
          <small>
          <i class="fa fa-tags"></i>
            kde, gcompris
          </small>
        </div>
        

      </div>

      
      <div class="content-panel feedback">
        I <i class="fa fa-heart"></i> feedback.<br />
        Let me know what you think of this article on twitter <a href="http://www.twitter.com/RudraNilBasu">@RudraNilBasu</a> or leave a comment below!
      </div>
      

      
      <div class="content-panel comments">
        <div id="disqus_thread">
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
      </div>
      

      

    </div>

  </div>

</div>

<!--

<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
function disqus_config() { this.experiment.enable_scroll_container = true; }
var disqus_shortname = "r_n_b"; // required: replace example with your forum shortname
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>

-->

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://rudranilbasu.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            

      </div>
    </div>

    <div class="footer clearfix">
  <div class="col-md-6">
    Made with <i class="fa fa-heart"></i> by <a href="https://twitter.com/RudraNilBasu">RudraNilBasu</a>
  </div>
  <div class="col-md-6">
    &lt;/&gt; on <a href="https://github.com/RudraNilBasu">Github</a> &nbsp;<i class="fa fa-github-alt"></i>
  </div>
</div>

<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="/js/jquery.mmenu.min.all.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
   $(document).ready(function() {
      $("#my-menu").mmenu().on( "closed.mm", function() {
            $(".menu-button").show();
         });
      $(".menu-button").click(function() {
        $(".menu-button").hide();
        $("#my-menu").trigger("open.mm");
      });
   });
</script>




<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', '']);
          _gaq.push(['_trackPageview']);
  (function () {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';

      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
  })();
</script>



    </body>
</html>
